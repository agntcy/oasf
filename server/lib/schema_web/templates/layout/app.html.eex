<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
  <meta name="description" content="Open Agentic Schema Framework">
  <title>Open Agentic Schema Framework</title>

  <link rel="stylesheet" href='<%= Routes.static_path(@conn, "/css/bootstrap-4.6.2.min.css") %>'/>
  <link rel="stylesheet" href='<%= Routes.static_path(@conn, "/css/bootstrap.select-1.13.18.min.css") %>'/>
  <link rel="stylesheet" href='<%= Routes.static_path(@conn, "/css/fontawesome-6.4.0.min.css") %>'/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">

  <link rel="stylesheet" href='<%= Routes.static_path(@conn, "/css/app.css") %>'/>

  <script type="text/javascript" src='<%= Routes.static_path(@conn, "/js/jquery-3.5.1.slim.min.js") %>'></script>

  <script type="text/javascript" src='<%= Routes.static_path(@conn, "/js/app.js") %>'></script>
  <script type="text/javascript" src='<%= Routes.static_path(@conn, "/js/profiles.js") %>'></script>

  <script>
    document.onreadystatechange = function(e)
    {
      if (document.readyState === 'interactive')
      {
        let selected_extensions = get_selected_extensions();
        let selected_profiles = get_selected_profiles();

        $.each(selected_extensions, function(key, value) {
          $("#" + key).prop('checked', value);
        });

        // update the links with the selected extensions and profiles
        const params = build_url_params(selected_extensions, selected_profiles);
        $(".sidebar-section a").each(function() {
          this.href = this.href + params;
        });

        // Also update main navigation links
        $(".top-navbar-nav a.nav-link").each(function() {
          this.href = this.href + params;
        });

        // set the profile checkboxes
        init_selected_profiles();

        // initialize extension-profile dependencies
        init_extension_profile_dependencies();
      }
    };

    $(document).ready(function () {
      let selected_extensions = get_selected_extensions();
      let extensions = $("#extensions-list :checkbox");
      extensions.on("change", function() {
        extensions.each(function(){
        selected_extensions[this.id] = this.checked;
        });
        set_selected_extensions(selected_extensions);

        // Get current profiles and build complete URL
        const selected_profiles = get_selected_profiles();
        const params = build_url_params(selected_extensions, selected_profiles);

        window.location.search = params;
      });

      // init the attributes dropdown filters
      init_selected_attributes();

      $("a.nav-link.active").removeClass("active");
      let path = window.location.pathname.replace(/^\/[\d.]+(?:-[^\/]+)?/, '');
      switch (path) {
        case '/':
          $('#home_id a.nav-link').addClass("active");
          break;
        case '/main_skills':
          $('#skills_id a.nav-link').addClass("active");
          $('#classes_id a.nav-link').addClass("active");
          break;
        case '/main_domains':
          $('#domains_id a.nav-link').addClass("active");
          $('#classes_id a.nav-link').addClass("active");
          break;
        case '/main_modules':
          $('#modules_id a.nav-link').addClass("active");
          $('#classes_id a.nav-link').addClass("active");
          break;
        case '/dictionary':
          $('#dictionary_id a.nav-link').addClass("active");
          break;
        case '/objects':
          $('#objects_id a.nav-link').addClass("active");
          break;
        case '/data_types':
          $('#data_types_id a.nav-link').addClass("active");
          break;
      }
    });
  </script>
</head>

<body class="bg-light">

<nav class="navbar navbar-light navbar-expand-md">
  <a class="navbar-brand d-md-none" href="<%= Routes.static_path(@conn, "/?extensions=") %>" onclick="reset_home_page()">
    <img src='<%= Routes.static_path(@conn, "/images/oasf.png") %>' alt="OASF" height="48" class="d-inline-block align-top">
  </a>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
    <i class="fas fa-chevron-down"></i>
  </button>

  <nav class="navbar navbar-bg collapse navbar-collapse navbar-expand-md navbar-light fixed-left">
    <!-- Sidebar Header (Logo and Version) - Static -->
    <div class="sidebar-header">
      <div class="oasf-logo">
        <a href="<%= Routes.static_path(@conn, "/?extensions=") %>" onclick="reset_home_page()">
          <img src='<%= Routes.static_path(@conn, "/images/oasf.png") %>' alt="OASF"/>
        </a>
      </div>
      <h6 class="container-fluid version">
      <form autocomplete="off">
        <select
          class="select-version"
          id="select_version"
          onchange="selectVersionFun()">
          <%= raw select_versions(@conn) %>
        </select>
        </form>
      </h6>

      <script>
      function selectVersionFun() {
        let x = document.getElementById("select_version").value;
        reset_home_page();
        window.open(x, "_self");
      }
      </script>
    </div>

    <!-- Sidebar Content - Scrollable -->
    <div class="sidebar-content">
      <%= if map_size(@extensions) > 0 do %>
      <!-- Extensions Section -->
      <div class="sidebar-section">
        <a target="_blank" class="sidebar-section-header" href=https://github.com/agntcy/oasf/blob/main/schema/extensions.md>
          <i class="fas fa-layer-group"></i> Extensions
          <hr class="divider"/>
        </a>
        <div class="sidebar-section-content" id="extensions-list">
          <ul class="sidebar-nav">
            <%= for {_key, map} <- @extensions do %>
            <% name = map[:name] %>
            <li class="sidebar-nav-item">
              <label for="<%= name %>">
                <input type="checkbox" id="<%= name %>">
                <%= raw format_extension(map) %>
              </label>
            </li>
            <% end %>
          </ul>
        </div>
      </div>
      <% end %>

      <%= if map_size(@profiles) > 0 do %>
      <!-- Profiles Section -->
      <div class="sidebar-section">
        <a id="profiles-link" class="sidebar-section-header" href='<%= Routes.static_path(@conn, "/profiles") %>'>
          <i class="fas fa-tag"></i> Profiles
          <hr class="divider"/>
        </a>
        <div class="sidebar-section-content" id="profiles-list">
          <ul class="sidebar-nav">
            <%= for {name, map} <- @profiles do %>
            <li class="sidebar-nav-item profile-item" data-profile-name="<%= name %>"
                data-toggle="tooltip" title='<%= raw format_profile(map) %>'>
              <label>
                <input type="checkbox" data-profile="<%= name %>" id="<%= String.replace(name, "/", "-") %>">
                <%= map[:caption] %>
              </label>
            </li>
            <% end %>
          </ul>
        </div>
      </div>
      <% end %>

      <!-- Display Options Section -->
      <div class="sidebar-section">
        <div class="sidebar-section-header">
          <i class="fas fa-cog"></i> Options
          <hr class="divider"/>
        </div>
        <div class="sidebar-section-content">
          <ul class="sidebar-nav">
            <li class="sidebar-nav-item">
              <label>
                <input type="checkbox" id="show-deprecated-global" class="show-deprecated-checkbox" data-toggle="collapse" data-target=".deprecated" onclick="on_click_show_deprecated(this)">
                Show deprecated items
              </label>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <div class="collapse navbar-collapse" id="navbarCollapse">
    <ul class="top-navbar-nav navbar-nav ml-auto">
      <li id="objects_id"  class="nav-item">
        <a class="nav-link" href='<%= Routes.static_path(@conn, "/objects") %>'>Objects</a>
      </li>
      <li id="classes_id" class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" role="button">Classes</a>
        <div class="dropdown-content">
          <a class="dropdown-link" href='<%= Routes.static_path(@conn, "/main_skills") %>'>Skills</a>
          <a class="dropdown-link" href='<%= Routes.static_path(@conn, "/main_domains") %>'>Domains</a>
          <a class="dropdown-link" href='<%= Routes.static_path(@conn, "/main_modules") %>'>Modules</a>
        </div>
      </li>
      <li id="skills_id" class="nav-item">
        <a class="nav-link" href='<%= Routes.static_path(@conn, "/main_skills") %>'>Skills</a>
      </li>
      <li id="domains_id" class="nav-item">
        <a class="nav-link" href='<%= Routes.static_path(@conn, "/main_domains") %>'>Domains</a>
      </li>
      <li id="modules_id" class="nav-item">
        <a class="nav-link" href='<%= Routes.static_path(@conn, "/main_modules") %>'>Modules</a>
      </li>
      <li id="dictionary_id" class="nav-item">
        <a class="nav-link" href='<%= Routes.static_path(@conn, "/dictionary") %>'>Dictionary</a>
      </li>
      <li id="data_types_id" class="nav-item">
        <a class="nav-link" href='<%= Routes.static_path(@conn, "/data_types") %>'>Data Types</a>
      </li>

      <div class="navbar-text">|</div>

      <li id="resources_id" class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" role="button">Resources</a>
        <div class="dropdown-content">
          <a class="dropdown-link" target="_blank" href='https://docs.agntcy.org/oasf/open-agentic-schema-framework/'> Documentation</a>
          <a class="dropdown-link" target="_blank" href='<%= Routes.static_path(@conn, "/doc") %>'>API Documentation</a>
          <a class="dropdown-link" target="_blank" href="https://github.com/agntcy/oasf">Fork Me on GitHub</a>
          <a class="dropdown-link" target="_blank" href="https://github.com/agntcy/oasf/blob/main/CONTRIBUTING.md">Contributing to OASF</a>
        </div>
      </li>
    </ul>
  </div>
</nav>

<!-- Sidebar Toggle Button - positioned in top-left corner -->
<button id="sidebar-toggle" class="sidebar-toggle" title="Toggle sidebar">
  <i id="sidebar-toggle-icon" class="fas fa-chevron-left"></i>
</button>

<div class="main-page">
  <main role="main" class="container-fluid">
    <%= @inner_content %>
  </main>
</div>

<div class="footer">
  OASF Server version <%= Schema.build_version() %>.
  Copyright &copy; 2025 Cisco and/or its affiliates.
  <a href="https://www.cisco.com/c/en/us/about/legal/terms-conditions.html">Terms & Conditions</a> | <a href="https://www.cisco.com/c/en/us/about/legal/privacy-full.html">Privacy Policy</a>
</div>

<script type="text/javascript" src='<%= Routes.static_path(@conn, "/js/popper.min.js") %>'></script>
<script type="text/javascript" src='<%= Routes.static_path(@conn, "/js/bootstrap-4.6.2.bundle.min.js") %>'></script>
<script type="text/javascript" src='<%= Routes.static_path(@conn, "/js/bootstrap.select-1.13.18.min.js") %>'></script>
<script type="text/javascript" src='<%= Routes.static_path(@conn, "/js/sorttable.js") %>'></script>

<script>
  $(function () {
    $('[data-toggle="tooltip"]').tooltip({
      delay: { "show": 300, "hide": 100 }
    })
  });

  // Profile highlighting functionality
  window.highlightApplicableProfiles = function(applicableProfiles) {
    // Reset all profile highlighting
    $('.profile-item').removeClass('profile-applicable profile-not-applicable');

    if (!applicableProfiles || applicableProfiles.length === 0) {
      return;
    }

    // Add highlighting classes
    $('.profile-item').each(function() {
      const profileName = $(this).data('profile-name');
      if (applicableProfiles.includes(profileName)) {
        $(this).addClass('profile-applicable');
      } else {
        $(this).addClass('profile-not-applicable');
      }
    });
  };

  // Clear profile highlighting
  window.clearProfileHighlighting = function() {
    $('.profile-item').removeClass('profile-applicable profile-not-applicable');
  };
</script>

</body>
</html>
